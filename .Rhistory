knitr::opts_chunk$set(echo = TRUE)
library(sf)
library(tmap)
library(units)
library(tidyverse)
library(dplyr)
library(leaflet)
library(tidyr)
library(ggplot2)
#check
election <- st_read("data/elections/eld.kmz")
x = readOGR("data/elections/eld.kmz", "Elections")
library(rgdal)
#check
election_input <- st_read("data/elections/eld.kmz")
x = readOGR("data/elections/eld.kmz", "Elections")
elections <- readOGR(dsn="data/elections",
layer = "eld")
planning <- readOGR(dsn = "data/planning",
layer = "MP14_PLNG_AREA_WEB_PL")
glimpse(elections)
glimpse(planning)
eld <- st_read("data/elections/eld.shp")
glimpse(eld)
eld <- st_read("data/elections/eld.shp")
planning <- st_read("data/elections/MP14_PLNG_AREA_WEB_PL")
planning <- st_read("data/elections/MP14_PLNG_AREA_WEB_PL.shp")
planning <- st_read("data/planning/MP14_PLNG_AREA_WEB_PL.shp")
glimpse(elections)
glimpse(planning)
glimpse(eld)
glimpse(eld)
tm_shape(eld) + tm_fill() + tm_borders()
tm_shape(eld) + tm_fill() + tm_borders() + tm_layout(title = "Election Boundaries")
tm_shape(eld) + tm_fill() + tm_borders() + tm_layout(title = "Election Boundaries") + tm_style("classic")
tm_shape(eld) + tm_fill() + tm_borders() + tm_layout(title = "Election Boundaries") + tm_style("classic")
map_elections = tm_shape(eld) + tm_fill() + tm_borders() + tm_layout(title = "Election Boundaries")
map_elections + tm_style("classic")
map_elections = tm_shape(eld) + tm_fill() + tm_borders()
map_elections + tm_style("classic")+ tm_layout(title = "Election Boundaries")
map_elections + tm_style("classic") + tm_layout(title = "Election Bounds")
tmap_mode = ("view")
map_elections = tm_shape(eld) + tm_fill() + tm_borders()
map_elections + tm_style("classic") + tm_layout(title = "Election Bounds")
tmap_mode("view")
map_elections = tm_shape(eld) + tm_fill() + tm_borders()
map_elections + tm_style("classic") + tm_layout(title = "Election Bounds")
map_elections = tm_shape(eld) + tm_fill() + tm_borders() + tm_polygons("Name", legend.show= F) + tm_text("Name", size = 1/2)
map_elections + tm_style("classic") + tm_layout(title = "Election Bounds")
tmap_mode("plot")
map_elections = tm_shape(eld) + tm_fill() + tm_borders() + tm_polygons("Name", legend.show= F) + tm_text("Name", size = 1/2)
map_elections + tm_style("classic") + tm_layout(title = "Election Bounds")
map_elections = tm_shape(eld) + tm_fill() + tm_borders() + tm_polygons("Name", legend.show= F) + tm_text("Name", size = 1/4)
map_elections + tm_style("classic") + tm_layout(title = "Election Bounds")
map_elections + tm_layout(title = "Election Bounds")
map_elections = tm_shape(eld) + tm_fill() + tm_borders() + tm_polygons("Name", legend.show= F) + tm_text("Name", size = 1/3)
map_elections + tm_layout(title = "Election Bounds")
glimpse(planning)
map_planning = tm_shape(planning) + tm_fill() + tm_borders() + tm_polygons("PLN_AREA_N", legend.show= F) + tm_text("PLN_AREA_N", size = 1/3)
map_planning + tm_layout(title = "Planning Areas")
sixtysix_colors <- list(
red="#D0445E",
blue="#0077E0",
purple="#C92EC4",
green="#009871",
orange="#9C7200",
grey="#009871",
light_red="#EE6178"
)
#Some formatting
sixtysix_colors <- list(
red="#D0445E",
blue="#0077E0",
purple="#C92EC4",
green="#009871",
orange="#9C7200",
grey="#009871",
light_red="#EE6178"
)
theme_map_sixtysix <- function(){
ggthemes::theme_map() %+replace%
theme(
text = ggthemes::theme_fivethirtyeight()$text,
title = ggthemes::theme_fivethirtyeight()$plot.title,
panel.grid.major = element_line(color="grey90")
)
}
install.packages("ggthemes")
theme_map_sixtysix <- function(){
ggthemes::theme_map() %+replace%
theme(
text = ggthemes::theme_fivethirtyeight()$text,
title = ggthemes::theme_fivethirtyeight()$plot.title,
panel.grid.major = element_line(color="grey90")
)
}
glimpse(planning)
eld <- st_read("data/elections/eld.shp")
planning <- st_read("data/planning/MP14_PLNG_AREA_WEB_PL.shp")
planning <- st_transform(planning, st_crs(eld))
map_planning = tm_shape(planning) + tm_fill() + tm_borders() + tm_polygons("PLN_AREA_N", legend.show= F) + tm_text("PLN_AREA_N", size = 1/3)
map_planning + tm_layout(title = "Planning Areas")
st_crs(planning)
st_crs(eld)
View(eld)
View(planning)
#divs 16 = eld
ggplot(
eld +
geom_sf(
color = sixtysix_colors$light_red,
size=2,
fill=NA
) +
geom_text(
aes(x=X, y=Y, label = ED_CODE),
data = with(
eld,
data.frame(ED_CODE, st_centroid(geometry) %>% st_coordinates())
),
color=sixtysix_colors$light_red,
size=4,
fontface="bold"
) +
geom_sf(
data=planning,
color = "black",
size=1,
fill=NA
) +
geom_text(
aes(x=X, y=Y, label = PLN_AREA_C),
data = with(
planning,
data.frame(PLN_AREA_C, st_centroid(geometry) %>% st_coordinates())
),
color="black",
size=4
) +
scale_color_identity(guide=FALSE) +
theme_map_sixtysix() +
ggtitle("Division change in Ward 5"))
eld) +
ggplot(
eld
) +
geom_sf(
color = sixtysix_colors$light_red,
size=2,
fill=NA
) +
geom_text(
aes(x=X, y=Y, label = ED_CODE),
data = with(
eld,
data.frame(ED_CODE, st_centroid(geometry) %>% st_coordinates())
),
color=sixtysix_colors$light_red,
size=4,
fontface="bold"
) +
geom_sf(
data=planning,
color = "black",
size=1,
fill=NA
) +
geom_text(
aes(x=X, y=Y, label = PLN_AREA_C),
data = with(
planning,
data.frame(PLN_AREA_C, st_centroid(geometry) %>% st_coordinates())
),
color="black",
size=4
) +
scale_color_identity(guide=FALSE) +
theme_map_sixtysix() +
ggtitle("Division change in Ward 5")
ggplot(
eld
) +
geom_sf(
color = sixtysix_colors$light_red,
size=1,
fill=NA
) +
geom_text(
aes(x=X, y=Y, label = ED_CODE),
data = with(
eld,
data.frame(ED_CODE, st_centroid(geometry) %>% st_coordinates())
),
color=sixtysix_colors$light_red,
size=4,
fontface="bold"
) +
geom_sf(
data=planning,
color = "black",
size=1,
fill=NA
) +
geom_text(
aes(x=X, y=Y, label = PLN_AREA_C),
data = with(
planning,
data.frame(PLN_AREA_C, st_centroid(geometry) %>% st_coordinates())
),
color="black",
size=4
) +
scale_color_identity(guide=FALSE) +
theme_map_sixtysix() +
ggtitle("Division change in Ward 5")
ggplot(
eld
) +
geom_sf(
color = sixtysix_colors$light_red,
size=1,
fill=NA
) +
geom_text(
aes(x=X, y=Y, label = ED_CODE),
data = with(
eld,
data.frame(ED_CODE, st_centroid(geometry) %>% st_coordinates())
),
color=sixtysix_colors$light_red,
size=4,
fontface="bold"
) +
geom_sf(
data=planning,
color = "black",
size=1,
fill=NA
) +
geom_text(
aes(x=X, y=Y, label = PLN_AREA_C),
data = with(
planning,
data.frame(PLN_AREA_C, st_centroid(geometry) %>% st_coordinates())
),
color="black",
size=1/2
) +
scale_color_identity(guide=FALSE) +
theme_map_sixtysix() +
ggtitle("Division change in Ward 5")
ggplot(
eld
) +
geom_sf(
color = sixtysix_colors$light_red,
size=1,
fill=NA
) +
geom_text(
aes(x=X, y=Y, label = ED_CODE),
data = with(
eld,
data.frame(ED_CODE, st_centroid(geometry) %>% st_coordinates())
),
color=sixtysix_colors$light_red,
size=4,
fontface="bold"
) +
geom_sf(
data=planning,
color = "black",
size=1,
fill=NA
) +
geom_text(
aes(x=X, y=Y, label = PLN_AREA_C),
data = with(
planning,
data.frame(PLN_AREA_C, st_centroid(geometry) %>% st_coordinates())
),
color="black",
size=4
) +
scale_color_identity(guide=FALSE) +
theme_map_sixtysix() +
ggtitle("Election Boundaries vs Planning Areas")
ggplot(
eld
) +
geom_sf(
color = sixtysix_colors$light_red,
size=1,
fill=NA
) +
geom_text(
aes(x=X, y=Y, label = ED_CODE),
data = with(
eld,
data.frame(ED_CODE, st_centroid(geometry) %>% st_coordinates())
),
color=sixtysix_colors$light_red,
size=4,
fontface="bold"
) +
geom_sf(
data=planning,
color = "black",
size=1,
fill=NA
) +
geom_text(
aes(x=X, y=Y, label = PLN_AREA_C),
data = with(
planning,
data.frame(PLN_AREA_C, st_centroid(geometry) %>% st_coordinates())
),
color="black",
size=4
) +
scale_color_identity(guide=FALSE) +
theme_map_sixtysix() +
ggtitle("Election Boundaries (Red) vs Planning Areas (Black)")
ggplot(
eld
) +
geom_sf(
color = sixtysix_colors$light_red,
size=1,
fill=NA
) +
geom_text(
aes(x=X, y=Y, label = ED_CODE),
data = with(
eld,
data.frame(ED_CODE, st_centroid(geometry) %>% st_coordinates())
),
color=sixtysix_colors$light_red,
size=4,
fontface="bold"
) +
geom_sf(
data=planning,
color = "black",
size=1,
fill=NA
) +
geom_text(
aes(x=X, y=Y, label = PLN_AREA_C),
data = with(
planning,
data.frame(PLN_AREA_C, st_centroid(geometry) %>% st_coordinates())
),
color="black",
size=4
) +
scale_color_identity(guide=FALSE) +
theme_map_sixtysix() +
ggtitle("Election Boundaries (Red) vs \n Planning Areas (Black)")
areal_weights
areal_weights <- st_intersection(
eld,
planning
) %>%
mutate(area = st_area(geometry)) %>%
as.data.frame() %>%
select(Name, PLN_AREA_N, area) %>%
group_by(Name) %>%
mutate(prop_of_eld = as.numeric(area / sum(area)))
areal_weights <- st_intersection(
eld,
planning
) %>%
mutate(area = st_area(geometry)) %>%
as.data.frame() %>%
select(Name, PLN_AREA_N, area) %>%
group_by(Name) %>%
mutate(prop_of_eld = as.numeric(area / sum(area)))
areal_weights <- st_intersection(
eld,
planning
) %>%
mutate(area = st_area(geometry)) %>%
as.data.frame() %>%
select(Name, PLN_AREA_N, area) %>%
group_by(Name) %>%
mutate(prop_of_eld = as.numeric(area / sum(area)))
areal_weights <- st_intersection(
eld,
planning
)
areal_weights <- st_intersection(
st_make_valid(eld),
st_make_valid(planning)
)
areal_weights
View(areal_weights)
